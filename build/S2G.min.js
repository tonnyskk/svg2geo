"use strict";function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function _toConsumableArray(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol?"symbol":typeof a};!function(a,b){"function"==typeof define&&define.amd?define([],b):"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?module.exports=b():a.X2JS=b()}(window||self,function(){return function(a){function b(){void 0===a.escapeMode&&(a.escapeMode=!0),a.attributePrefix=a.attributePrefix||"_",a.arrayAccessForm=a.arrayAccessForm||"none",a.emptyNodeForm=a.emptyNodeForm||"text",void 0===a.enableToStringFunc&&(a.enableToStringFunc=!0),a.arrayAccessFormPaths=a.arrayAccessFormPaths||[],void 0===a.skipEmptyTextNodesForObj&&(a.skipEmptyTextNodesForObj=!0),void 0===a.stripWhitespaces&&(a.stripWhitespaces=!0),a.datetimeAccessFormPaths=a.datetimeAccessFormPaths||[],void 0===a.useDoubleQuotes&&(a.useDoubleQuotes=!1),a.xmlElementsFilter=a.xmlElementsFilter||[],a.jsonPropertiesFilter=a.jsonPropertiesFilter||[],void 0===a.keepCData&&(a.keepCData=!1)}function c(){}function d(a){var b=a.localName;return null==b&&(b=a.baseName),null!=b&&""!=b||(b=a.nodeName),b}function e(a){return a.prefix}function f(a){return"string"==typeof a?a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;"):a}function g(a,b,c,d){for(var e=0;e<a.length;e++){var f=a[e];if("string"==typeof f){if(f==d)break}else if(f instanceof RegExp){if(f.test(d))break}else if("function"==typeof f&&f(b,c,d))break}return e!=a.length}function h(b,c,d){switch(a.arrayAccessForm){case"property":b[c]instanceof Array?b[c+"_asArray"]=b[c]:b[c+"_asArray"]=[b[c]]}!(b[c]instanceof Array)&&a.arrayAccessFormPaths.length>0&&g(a.arrayAccessFormPaths,b,c,d)&&(b[c]=[b[c]])}function i(a){var b=a.split(/[-T:+Z]/g),c=new Date(b[0],b[1]-1,b[2]),d=b[5].split(".");if(c.setHours(b[3],b[4],d[0]),d.length>1&&c.setMilliseconds(d[1]),b[6]&&b[7]){var e=60*b[6]+Number(b[7]),f=/\d\d-\d\d:\d\d$/.test(a)?"-":"+";e=0+("-"==f?-1*e:e),c.setMinutes(c.getMinutes()-e-c.getTimezoneOffset())}else-1!==a.indexOf("Z",a.length-1)&&(c=new Date(Date.UTC(c.getFullYear(),c.getMonth(),c.getDate(),c.getHours(),c.getMinutes(),c.getSeconds(),c.getMilliseconds())));return c}function j(b,c,d){if(a.datetimeAccessFormPaths.length>0){var e=d.split(".#")[0];return g(a.datetimeAccessFormPaths,b,c,e)?i(b):b}return b}function k(b,c,d,e){return c==z.ELEMENT_NODE&&a.xmlElementsFilter.length>0?g(a.xmlElementsFilter,b,d,e):!0}function l(b,c){if(b.nodeType==z.DOCUMENT_NODE){for(var f=new Object,g=b.childNodes,i=0;i<g.length;i++){var m=g.item(i);if(m.nodeType==z.ELEMENT_NODE){var n=d(m);f[n]=l(m,n)}}return f}if(b.nodeType==z.ELEMENT_NODE){var f=new Object;f.__cnt=0;for(var g=b.childNodes,i=0;i<g.length;i++){var m=g.item(i),n=d(m);if(m.nodeType!=z.COMMENT_NODE){var o=c+"."+n;k(f,m.nodeType,n,o)&&(f.__cnt++,null==f[n]?(f[n]=l(m,o),h(f,n,o)):(null!=f[n]&&(f[n]instanceof Array||(f[n]=[f[n]],h(f,n,o))),f[n][f[n].length]=l(m,o)))}}for(var p=0;p<b.attributes.length;p++){var q=b.attributes.item(p);f.__cnt++,f[a.attributePrefix+q.name]=q.value}var r=e(b);return null!=r&&""!=r&&(f.__cnt++,f.__prefix=r),null!=f["#text"]&&(f.__text=f["#text"],f.__text instanceof Array&&(f.__text=f.__text.join("\n")),a.stripWhitespaces&&(f.__text=f.__text.trim()),delete f["#text"],"property"==a.arrayAccessForm&&delete f["#text_asArray"],f.__text=j(f.__text,n,c+"."+n)),null!=f["#cdata-section"]&&(f.__cdata=f["#cdata-section"],delete f["#cdata-section"],"property"==a.arrayAccessForm&&delete f["#cdata-section_asArray"]),0==f.__cnt&&"text"==a.emptyNodeForm?f="":1==f.__cnt&&null!=f.__text?f=f.__text:1!=f.__cnt||null==f.__cdata||a.keepCData?f.__cnt>1&&null!=f.__text&&a.skipEmptyTextNodesForObj&&(a.stripWhitespaces&&""==f.__text||""==f.__text.trim())&&delete f.__text:f=f.__cdata,delete f.__cnt,!a.enableToStringFunc||null==f.__text&&null==f.__cdata||(f.toString=function(){return(null!=this.__text?this.__text:"")+(null!=this.__cdata?this.__cdata:"")}),f}return b.nodeType==z.TEXT_NODE||b.nodeType==z.CDATA_SECTION_NODE?b.nodeValue:void 0}function m(b,c,d,e){var g="<"+(null!=b&&null!=b.__prefix?b.__prefix+":":"")+c;if(null!=d)for(var h=0;h<d.length;h++){var i=d[h],j=b[i];a.escapeMode&&(j=f(j)),g+=" "+i.substr(a.attributePrefix.length)+"=",g+=a.useDoubleQuotes?'"'+j+'"':"'"+j+"'"}return g+=e?"/>":">"}function n(a,b){return"</"+(null!=a.__prefix?a.__prefix+":":"")+b+">"}function o(a,b){return-1!==a.indexOf(b,a.length-b.length)}function p(b,c){return!!("property"==a.arrayAccessForm&&o(c.toString(),"_asArray")||0==c.toString().indexOf(a.attributePrefix)||0==c.toString().indexOf("__")||b[c]instanceof Function)}function q(a){var b=0;if(a instanceof Object)for(var c in a)p(a,c)||b++;return b}function r(b,c,d){return 0==a.jsonPropertiesFilter.length||""==d||g(a.jsonPropertiesFilter,b,c,d)}function s(b){var c=[];if(b instanceof Object)for(var d in b)-1==d.toString().indexOf("__")&&0==d.toString().indexOf(a.attributePrefix)&&c.push(d);return c}function t(b){var c="";return null!=b.__cdata&&(c+="<![CDATA["+b.__cdata+"]]>"),null!=b.__text&&(c+=a.escapeMode?f(b.__text):b.__text),c}function u(b){var c="";return b instanceof Object?c+=t(b):null!=b&&(c+=a.escapeMode?f(b):b),c}function v(a,b){return""===a?b:a+"."+b}function w(a,b,c,d){var e="";if(0==a.length)e+=m(a,b,c,!0);else for(var f=0;f<a.length;f++)e+=m(a[f],b,s(a[f]),!1),e+=x(a[f],v(d,b)),e+=n(a[f],b);return e}function x(a,b){var c="",d=q(a);if(d>0)for(var e in a)if(!p(a,e)&&(""==b||r(a,e,v(b,e)))){var f=a[e],g=s(f);if(null==f||void 0==f)c+=m(f,e,g,!0);else if(f instanceof Object)if(f instanceof Array)c+=w(f,e,g,b);else if(f instanceof Date)c+=m(f,e,g,!1),c+=f.toISOString(),c+=n(f,e);else{var h=q(f);h>0||null!=f.__text||null!=f.__cdata?(c+=m(f,e,g,!1),c+=x(f,v(b,e)),c+=n(f,e)):c+=m(f,e,g,!0)}else c+=m(f,e,g,!1),c+=u(f),c+=n(f,e)}return c+=u(a)}var y="1.2.0";a=a||{},b(),c();var z={ELEMENT_NODE:1,TEXT_NODE:3,CDATA_SECTION_NODE:4,COMMENT_NODE:8,DOCUMENT_NODE:9};this.parseXmlString=function(a){var b=window.ActiveXObject||"ActiveXObject"in window;if(void 0===a)return null;var c;if(window.DOMParser){var d=new window.DOMParser,e=null;if(!b)try{e=d.parseFromString("INVALID","text/xml").getElementsByTagName("parsererror")[0].namespaceURI}catch(f){e=null}try{c=d.parseFromString(a,"text/xml"),null!=e&&c.getElementsByTagNameNS(e,"parsererror").length>0&&(c=null)}catch(f){c=null}}else 0==a.indexOf("<?")&&(a=a.substr(a.indexOf("?>")+2)),c=new ActiveXObject("Microsoft.XMLDOM"),c.async="false",c.loadXML(a);return c},this.asArray=function(a){return void 0===a||null==a?[]:a instanceof Array?a:[a]},this.toXmlDateTime=function(a){return a instanceof Date?a.toISOString():"number"==typeof a?new Date(a).toISOString():null},this.asDateTime=function(a){return"string"==typeof a?i(a):a},this.xml2json=function(a){return l(a)},this.xml_str2json=function(a){var b=this.parseXmlString(a);return null!=b?this.xml2json(b):null},this.json2xml_str=function(a){return x(a,"")},this.json2xml=function(a){var b=this.json2xml_str(a);return this.parseXmlString(b)},this.getVersion=function(){return y}}});var S2GNamespace=function(a){for(var b="undefined"!=typeof window&&null!==window?window:self,c=a.split("."),d=0;d<c.length;++d)b[c[d]]=b[c[d]]||{},b=b[c[d]];return b};S2GNamespace("Autodesk.BIM360.Convert"),function(a){var b=function(){function b(){var a=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];_classCallCheck(this,b),this.options=a,this.initialize()}return _createClass(b,[{key:"initialize",value:function(){this.x2js=new X2JS({stripWhitespaces:!0})}},{key:"parseSvgText",value:function(c){var d=[];if(!c)return d;var e=this.x2js.xml_str2json(c);if(!e||!e.svg)return console.warn("Invalid SVG text."),d;var f=e.svg,g=this._getSvgProps(f);return Object.keys(f).map(function(c,e){switch(c){case b.NodeTypes.Rectangle:case b.NodeTypes.Ellipse:case b.NodeTypes.Polygon:case b.NodeTypes.Polyline:var h=new a.S2GFeature(g);h.parse(c,f[c]),d.push(h)}}),d}},{key:"_getSvgProps",value:function(a){var c={},d={};return Object.keys(a).map(function(e,f){switch(e){case b.NodeTypes.Rectangle:case b.NodeTypes.Ellipse:case b.NodeTypes.Polygon:case b.NodeTypes.Polyline:break;case b.NodeTypes.Metadata:d=Object.assign({},a[e]);break;default:var g=Object.getOwnPropertyDescriptor(a,e);Object.defineProperty(c,e,g)}}),{svgProps:c,svgMetadata:d}}}]),b}();b.NodeTypes={Rectangle:"rect",Ellipse:"ellipse",Polygon:"polygon",Polyline:"path",Metadata:"metadata"},a.S2G=b}(Autodesk.BIM360.Convert),function(a){var b=function(){function a(b,c){_classCallCheck(this,a),this.type=b,this.coordinates=[].concat(_toConsumableArray(c))}return _createClass(a,[{key:"parse",value:function(a){}}]),a}();a.S2GShape=b}(Autodesk.BIM360.Convert),function(a){var b=function(a){function b(){var a=arguments.length<=0||void 0===arguments[0]?[]:arguments[0];return _classCallCheck(this,b),_possibleConstructorReturn(this,Object.getPrototypeOf(b).call(this,"Polygon",a))}return _inherits(b,a),_createClass(b,[{key:"parse",value:function(a){var b=a.metadata.markup_element._position,c=a.metadata.markup_element._size,d=b.split(" ");d.map(function(a,b,c){c[b]=parseFloat(a,10)});var e=c.split(" ");e.map(function(a,b,c){c[b]=parseFloat(a,10)}),this.coordinates.push(this._generateCoordinates(d,e))}},{key:"_generateCoordinates",value:function(a,b){var c=[];return c.push([a[0],a[1]]),c.push([a[0]+b[0],a[1]]),c.push([a[0]+b[0],a[1]-b[1]]),c.push([a[0],a[1]-b[1]]),c.push([a[0],a[1]]),c}}]),b}(a.S2GShape);a.S2GRectangle=b}(Autodesk.BIM360.Convert),function(a){var b=function(){function b(){var a=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];_classCallCheck(this,b),this.type="Feature",this.geometry={},this.properties=a}return _createClass(b,[{key:"parse",value:function(a,b){var c=this._getNodeProps(b);this.properties=Object.assign(this.properties,c);var d=this._getShapeInstance(a);d&&(d.parse(b),this.geometry=d)}},{key:"_getShapeInstance",value:function(b){switch(b){case a.S2G.NodeTypes.Rectangle:return new a.S2GRectangle;case a.S2G.NodeTypes.Ellipse:return console.warn("Unsupport shape: Ellipse"),null;case a.S2G.NodeTypes.Polygon:return console.warn("Unsupport shape: Polygon"),null;case a.S2G.NodeTypes.Polyline:return console.warn("Unsupport shape: Polyline"),null}}},{key:"_getNodeProps",value:function(b){var c=(a.S2G.NodeTypes.Metadata,Object.assign({},b));delete c.metadata;var d=Object.assign({},b.metadata||{});return{svgNodeProps:c,svgNodeMetadata:d}}}]),b}();a.S2GFeature=b}(Autodesk.BIM360.Convert);